webpackJsonp([13],{Wn5O:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("pw1w");var r=a("OS1Z"),o=a("BTaQ"),m=a("gyMJ"),i={components:{mavonEditor:r.mavonEditor,Form:o.Form,FormItem:o.FormItem,Button:o.Button,Col:o.Col,Row:o.Row,CheckboxGroup:o.CheckboxGroup,Checkbox:o.Checkbox,RadioGroup:o.RadioGroup,Radio:o.Radio,DatePicker:o.DatePicker,TimePicker:o.TimePicker,Select:o.Select,Option:o.Option,Input:o.Input},data:function(){return{formItem:{id:"",title:"",category_id:"",status:99,tag:[],date:new Date,time:new Date,create_time:[],markdown:"",content:""},ruleInline:{status:[{required:!0,message:"请选择状态"}],title:[{required:!0,message:"文章标题必须填写"}],category_id:[{required:!0,message:"文章分类必须选择"}],date:[{required:!0,message:"发布日期必须选择"}],time:[{required:!0,message:"发布时间必须选择"}]},category:[],tag:[]}},methods:{post:function(){var t=this;this.formItem.content=this.$refs.md.d_render;var e=this.formItem.date.getMonth()+1,a=this.formItem.date.getDate();e>=1&&e<=9&&(e="0"+e),a>=0&&a<=9&&(a="0"+a),this.formItem.create_time=this.formItem.date.getFullYear()+"-"+e+"-"+a+" "+this.formItem.date.getHours()+":"+this.formItem.date.getMinutes()+":"+this.formItem.date.getSeconds(),this.formItem.type="post",this.$refs.formItem.validate(function(e){e?t.formItem.id?m.d.update(t.formItem.id,t.formItem).then(function(e){0==e.errno&&e.data.id&&t.$router.push("/content/list")}):m.d.create(t.formItem).then(function(e){0==e.errno&&e.data.id&&t.$router.push("/content/list")}):t.$Message.error("请填写必要信息")})},getCategory:function(){var t=this;m.a.getList().then(function(e){t.category=e.data})},getTag:function(){var t=this;m.g.getList().then(function(e){t.tag=e.data})},get:function(t){var e=this;m.d.getInfo(t).then(function(t){var a=[];for(var r in t.data.tag)a.push(t.data.tag[r].id);t.data.tag=a,t.data.date=new Date(1e3*t.data.create_time),t.data.time=new Date(1e3*t.data.create_time),e.formItem=t.data})},imgAdd:function(t,e){var a=this,r=new FormData;r.append("image",e),m.f.upload(r).then(function(e){0==e.errno&&e.data.url&&a.$refs.md.$img2Url(t,e.data.url)})}},mounted:function(){this.$route.query.slug&&this.get(this.$route.query.slug),this.getCategory(),this.getTag()}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{ref:"formItem",attrs:{model:t.formItem,rules:t.ruleInline,"label-width":80}},[a("FormItem",{attrs:{label:"状态",prop:"status"}},[a("RadioGroup",{model:{value:t.formItem.status,callback:function(e){t.$set(t.formItem,"status",e)},expression:"formItem.status"}},[a("Radio",{attrs:{label:0}},[t._v("草稿")]),t._v(" "),a("Radio",{attrs:{label:99}},[t._v("发布")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"文章标题",prop:"title"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"文章标题"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),a("FormItem",{attrs:{label:"文章标识",prop:"slug"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"文章唯一标识，并作为参数构造url"},model:{value:t.formItem.slug,callback:function(e){t.$set(t.formItem,"slug",e)},expression:"formItem.slug"}})],1),t._v(" "),a("FormItem",{attrs:{label:"文章分类",prop:"category_id"}},[a("Select",{staticStyle:{width:"300px"},model:{value:t.formItem.category_id,callback:function(e){t.$set(t.formItem,"category_id",e)},expression:"formItem.category_id"}},t._l(t.category,function(t,e){return a("Option",{key:e,attrs:{value:t.id,label:t.name}})}),1)],1),t._v(" "),a("FormItem",{attrs:{label:"缩略图",prop:"thumb"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"使用编辑器上传得到地址"},model:{value:t.formItem.thumb,callback:function(e){t.$set(t.formItem,"thumb",e)},expression:"formItem.thumb"}})],1),t._v(" "),a("FormItem",{attrs:{label:"发布时间",prop:"date"}},[a("Row",[a("Col",{staticStyle:{width:"200px"},attrs:{span:"3"}},[a("FormItem",{attrs:{prop:"date"}},[a("DatePicker",{attrs:{type:"date",placeholder:"Select date"},model:{value:t.formItem.date,callback:function(e){t.$set(t.formItem,"date",e)},expression:"formItem.date"}})],1)],1),t._v(" "),a("Col",{staticStyle:{width:"200px"},attrs:{span:"3"}},[a("FormItem",{attrs:{prop:"time"}},[a("TimePicker",{attrs:{type:"time",placeholder:"Select time"},model:{value:t.formItem.time,callback:function(e){t.$set(t.formItem,"time",e)},expression:"formItem.time"}})],1)],1)],1)],1),t._v(" "),a("FormItem",{attrs:{label:"标签"}},[a("CheckboxGroup",{model:{value:t.formItem.tag,callback:function(e){t.$set(t.formItem,"tag",e)},expression:"formItem.tag"}},t._l(t.tag,function(e,r){return a("Checkbox",{key:r,attrs:{label:e.id}},[t._v(t._s(e.name))])}),1)],1),t._v(" "),a("FormItem",{attrs:{label:"文章内容"}},[a("div",{attrs:{id:"editor"}},[a("mavon-editor",{ref:"md",staticClass:"editor",on:{imgAdd:t.imgAdd},model:{value:t.formItem.markdown,callback:function(e){t.$set(t.formItem,"markdown",e)},expression:"formItem.markdown"}})],1)]),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.post}},[t._v("提交")])],1)],1)},staticRenderFns:[]},n=a("VU/8")(i,s,!1,null,null,null);e.default=n.exports}});
//# sourceMappingURL=13.2342c0d9f301f2dc7cbb.js.map